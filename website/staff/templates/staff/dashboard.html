{% extends 'staff/base.html' %}
{% load static %}

{% block content %}
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
    <h2>Rental Machine Dashboard</h2>
      <a href="{% url 'staff:customer_add' %}"
     style="background:#607d8b; color:white; padding:8px 12px; border-radius:5px; text-decoration:none; font-weight:bold;">
    👤 Add Customer
  </a>
     {% if user.is_staff %}
        <a href="{% url 'staff:rental_add' %}"
           style="background:#4CAF50; color:white; padding:8px 12px;
                  border-radius:5px; text-decoration:none; font-weight:bold;
                  align-items:right;">
            ➕ Add Rental Machine
        </a>
    {% endif %}
</div>

<!-- Summary Card -->
<div style="background:#2196f3; color:white; padding:12px 20px;
            border-radius:6px; display:inline-block; margin-bottom:20px;
            box-shadow:0 2px 5px rgba(0,0,0,0.15); font-size:16px;">
    <strong>Total Machines:</strong> {{ total_machines|default:"0" }}
</div>

<!-- Search and Filters -->
<form method="get" class="filter-form"
      style="margin-bottom:20px; display:flex; flex-wrap:wrap; gap:10px; align-items:center;">
    <input type="text" name="q" placeholder="🔍 Search..." value="{{ q }}"
           style="padding:6px; min-width:160px;">

    <select name="status" style="padding:6px;">
        <option value="">All Statuses</option>
        <option value="available" {% if status_filter == 'available' %}selected{% endif %}>Available</option>
        <option value="rented" {% if status_filter == 'rented' %}selected{% endif %}>Rented</option>
        <option value="maintenance" {% if status_filter == 'maintenance' %}selected{% endif %}>Maintenance</option>
        <option value="retired" {% if status_filter == 'retired' %}selected{% endif %}>Retired</option>
    </select>

    <select name="tier" style="padding:6px;">
        <option value="">All Value Tiers</option>
        <option value="low" {% if tier_filter == 'low' %}selected{% endif %}>Low</option>
        <option value="medium" {% if tier_filter == 'medium' %}selected{% endif %}>Medium</option>
        <option value="high" {% if tier_filter == 'high' %}selected{% endif %}>High</option>
        <option value="commercial" {% if tier_filter == 'commercial' %}selected{% endif %}>Commercial</option>
    </select>

    <button type="submit" style="padding:6px 12px; background:#2196f3; color:white; border:none; border-radius:4px;">
        Apply Filters
    </button>
</form>

<!-- Machine Table -->
<div style="overflow-x:auto;">
<table style="width:100%; border-collapse:collapse; background:white;">
    <thead style="background:#f5f5f5;">
        <tr>
            <th style="padding:8px; text-align:left;">Brand</th>
            <th style="padding:8px; text-align:left;">Model</th>
            <th style="padding:8px; text-align:left;">Serial Number</th>
            <th style="padding:8px; text-align:left;">Status</th>
            <th style="padding:8px; text-align:left;">Value Tier</th>
            <th style="padding:8px; text-align:left;">Location</th>
            <th style="padding:8px; text-align:center;">QR Code</th>
            {% if user.is_staff %}
            <th style="padding:8px; text-align:center;">Actions</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for machine in machines %}
        <tr style="border-bottom:1px solid #ddd; transition:background 0.2s;"
            onmouseover="this.style.background='#f9f9f9'"
            onmouseout="this.style.background='white'">
            <td style="padding:8px;">{{ machine.brand }}</td>
            <td style="padding:8px;">{{ machine.model }}</td>
            <td style="padding:8px;">{{ machine.serial_number }}</td>
            <td style="padding:8px;">{{ machine.status }}</td>
            <td style="padding:8px;">{{ machine.value_tier }}</td>
            <td style="padding:8px;">{{ machine.location }}</td>
            <td style="padding:8px; text-align:center;">
                {% if machine.id %}
                    <a href="{% url 'staff:rental_detail' machine.id %}">
                        <img src="{% url 'staff:rental_qr' machine.id %}"
                             alt="QR Code" width="50" height="50"
                             style="border:1px solid #ccc; border-radius:4px;">
                    </a>
                {% else %}
                    <span style="color:#999;">N/A</span>
                {% endif %}
            </td>
            {% if user.is_staff %}
            <td style="padding:8px; text-align:center;">
                {% if user.is_staff and machine.id %}
                    <a href="{% url 'staff:rental_delete' machine.id %}"
                       onclick="return confirm('⚠️ Are you sure you want to delete this machine?');"
                       style="color:#d9534f; text-decoration:none; font-weight:bold;">
                       🗑 Delete
                    </a>
                {% endif %}

            </td>
            {% endif %}
        </tr>
        {% empty %}
        <tr>
            <td colspan="8" style="padding:15px; text-align:center; color:#777;">
                No machines found matching your filters.
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</div>
{% endblock %}
